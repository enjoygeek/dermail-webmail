image: node:4.4.3

stages:
  - prep
  - build
  - web

prep:
  stage: prep
  script:
    - apt-get update -qq && apt-get install -y -qq curl
    - npm install
    - npm install forever browserify uglifyjs -g
    - cp .gitlab-ci.config.json config.json

build:
  stage: build
  script:
    - npm run prod

web:
  stage: web
  script:
    - forever start server.js
    - sleep 5
    - curl http://127.0.0.1:3000/prod.js
